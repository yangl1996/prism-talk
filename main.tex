\documentclass[svgnames]{beamer}
\mode<presentation>
\usetheme{default}
\usecolortheme{beaver}

\usepackage{graphicx, color, microtype}
\usepackage{tikz}
\usetikzlibrary{arrows}
\usetikzlibrary{positioning}
\usetikzlibrary{decorations.pathreplacing}
\usetikzlibrary{fit}

\usepackage[style=authortitle,backend=biber]{biblatex}
\addbibresource{ref.bib}

\title{Prism: Scaling Bitcoin by 10,000$\times$}

\author{Lei~Yang \inst{1} \and Vivek~Bagaria \inst{2} \and Gerui~Wang \inst{3}
\and Mohammad~Alizadeh \inst{1} \and David~Tse \inst{2} \and Giulia~Fanti \inst{4} \and Pramod~Viswanath \inst{3}}
\institute{\inst{1} MIT CSAIL \and \inst{2} Stanford University \and \inst{3}
University of Illinois Urbana-Champaign \and \inst{4} Carnegie Mellon University}

\date[SBC 2020]{The Stanford Blockchain Conference 2020}

\begin{document}
\beamertemplatenavigationsymbolsempty

\begin{frame}
\titlepage
\end{frame}

\begin{frame}
    \frametitle{Bitcoin: high security, low throughput, and long latency}
    \begin{block}{}
    \begin{itemize}
        \item \alert{Security}: 50\% adversary
            \pause
        \item \alert{Throughput}: 7 tps
        \item \alert{Confirmation Latency}: hours
    \end{itemize}
    \end{block}

    \pause
    \begin{block}{}
        How much better can we do \alert{theortically}
        \pause
        and \alert{practically}?

        \pause
        And how? % spoiler alert: we achieved good performance
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{This talk}
    \tableofcontents
\end{frame}

\section{The Prism consensus protocol}

\begin{frame}
    \frametitle{This talk}
    \tableofcontents[currentsection,currentsubsection]
\end{frame}

\begin{frame}
    \frametitle{Bitcoin: mine on the longest chain}
    \begin{figure}
        \tikzstyle{block} = [draw, fill=blue!20, rectangle, rounded corners, minimum height=1em, minimum width=1.6em, text centered]
        \begin{tikzpicture}[auto, node distance=2em, >=latex']
            \node[block](genesis){};
            \pause
            \node[block, below of=genesis](1){};
            \draw[->](1) to (genesis);
            \pause
            \node[block, below of=1](2){};
            \draw[->](2) to (1);
            \pause
            \node[block, below of=2](3){};
            \node[block, right of=3](3fork){};
            \draw[->](3fork) to (2);
            \draw[->](3) to (2);
            \node[block, below of=3](4){};
            \draw[->](4) to (3);
            \pause
            \node[block, below of=4](5){};
            \draw[->](5) to (4);
        \end{tikzpicture}
    \end{figure}
    \uncover<+->{Mining rate $f$ = 1 block per 10 min}
\end{frame}


\begin{frame}
    \frametitle{Bitcoin: $k$-deep confirmation rule}
    \begin{columns}
    \column{.5\textwidth}
    \begin{figure}
        \tikzstyle{block} = [draw, fill=blue!20, rectangle, rounded corners, minimum height=1.2em, minimum width=1.9em, text centered]
        \tikzstyle{confirmed} = [draw, fill=green!20, rectangle, rounded corners, minimum height=1.2em, minimum width=1.9em, text centered]
        \tikzstyle{deconfirmed} = [draw,dashed, fill=yellow!20, rectangle, rounded corners, minimum height=1.2em, minimum width=1.9em, text centered]
        \tikzstyle{badblock} = [draw, fill=red!20, rectangle, rounded corners, minimum height=1.2em, minimum width=1.9em, text centered]
        \tikzstyle{badblockunreleased} = [draw,dashed, fill=red!10, rectangle, rounded corners, minimum height=1.2em, minimum width=1.9em, text centered]
        \begin{tikzpicture}[auto, node distance=2.5em, >=latex']
            \node<1->[block](genesis){};
            \uncover<2,9-10>{
                \node[block, below of=genesis](mine){TX};
                \draw[->](mine) to (genesis);
            }
            \uncover<3-5, 11->{
                \node[confirmed, below of=genesis](mineconfirmed){TX};
                \draw[->](mineconfirmed) to (genesis);
                \node[left=1em of mineconfirmed](){Confirmed};
            }
            \uncover<6-8>{
                \node[deconfirmed, below of=genesis](minedeconfirmed){TX};
                \draw[->](minedeconfirmed) to (genesis);
            }
            \uncover<4>{
                \node[badblockunreleased, right of=mineconfirmed](bad1hidden){};
                \node[badblockunreleased, below of=bad1hidden](bad2hidden){};
                \draw[->](bad1hidden) to (genesis);
                \draw[->](bad2hidden) to (bad1hidden);
                \node[right=1em of bad1hidden](){Private chain};
            }
            \uncover<5-8,12->{
                \node[badblock, right of=mineconfirmed](bad1){};
                \node[badblock, below of=bad1](bad2){};
                \draw[->](bad1) to (genesis);
                \draw[->](bad2) to (bad1);
            }
            \uncover<7-8>{
                \node[block, below of=bad2](bad3){};
                \draw[->](bad3) to (bad2);
                \node[right=1em of bad3](){Longest chain};
            }
            \uncover<8>{
                \node[block, below of=bad3](bad4){};
                \draw[->](bad4) to (bad3);
            }
            \uncover<10->{
                \node[block, below of=mine](good1){};
                \draw[->](good1) to (mine);
                \node[block, below of=good1](good2){};
                \draw[->](good2) to (good1);
                \node[block, below of=good2](good3){};
                \draw[->](good3) to (good2);
                \node[block, below of=good3](good4){};
                \draw[->](good4) to (good3);
            }
            \uncover<11->{
                \draw[decoration={brace,mirror,raise=15pt,amplitude=6pt},decorate](mine.north) -- node[left=21pt] {$k$} (good4.south);
            }
            \uncover<12->{
                \node[left=1em of good4](){Longest chain};
            }
        \end{tikzpicture}
    \end{figure}
    \column{.5\textwidth}
    \uncover<13->{
        \begin{block}{}
        30\% adversary power

        \uncover<14->{
            \alert{For $10^{-3}$ attack probability, wait 250 mins!}
        }

        \smallskip
        {\small
        \centering
        \begin{tabular}{r | c}
            \hline
            $k$ & $\epsilon$ \\ \hline
            0 & 1.0000000 \\
            5 & 0.1773523 \\
            10 & 0.0416605 \\
            15 & 0.0101008 \\
            20 & 0.0024804 \\
            \alert<14->{25} & \alert<14->{0.0006132} \\
            30 & 0.0001522 \\
            35 & 0.0000379 \\
            40 & 0.0000095 \\
            45 & 0.0000024 \\
            50 & 0.0000006 \\ \hline
        \end{tabular}
        }
        \end{block}
    }
    \end{columns}
\end{frame}

\begin{frame}
    \frametitle{Increasing the mining rate harms the security}
    \begin{columns}
        \column{.5\textwidth}
        \begin{figure}
            \tikzstyle{block} = [draw, fill=blue!20, rectangle, rounded corners, minimum height=1em, minimum width=1.6em, text centered]
            \tikzstyle{badblockunreleased} = [draw,dashed, fill=red!10, rectangle, rounded corners, minimum height=1em, minimum width=1.6em, text centered]
            \begin{tikzpicture}[auto, node distance=2em, >=latex']
                \uncover<1->{
                \node[block](genesis){};
                \node[block, below of=genesis](1){};
                \draw[->](1) to (genesis);
                \node[block, below of=1](2){};
                \draw[->](2) to (1);
                \node[block, below of=2](3){};
                \draw[->](3) to (2);
                \node[block, below of=3](4){};
                \draw[->](4) to (3);
                \node[block, below of=4](5){};
                \draw[->](5) to (4);
                }
                \uncover<2->{
                \node[badblockunreleased, right of=1](b1){};
                \draw[->](b1) to (genesis);
                \node[badblockunreleased, below of=b1](b2){};
                \draw[->](b2) to (b1);
                \node[badblockunreleased, below of=b2](b3){};
                \draw[->](b3) to (b2);
                \node[badblockunreleased, below of=b3](b4){};
                \draw[->](b4) to (b3);
                }
                \uncover<3->{
                \node[block, right=5em of genesis](genesis){};
                \node[block, below of=genesis](1){};
                \draw[->](1) to (genesis);
                \node[block, right of=1](2){};
                \draw[->](2) to (genesis);
                \node[block, below of=2](3){};
                \draw[->](3) to (2);
                \node[block, below of=1](4){};
                \draw[->](4) to (1);
                \node[block, left of=4](5){};
                \draw[->](5) to (1);
                }
                \uncover<4->{
                \node[badblockunreleased, right of=2](b1){};
                \draw[->](b1) to (genesis);
                \node[badblockunreleased, below of=b1](b2){};
                \draw[->](b2) to (b1);
                \node[badblockunreleased, below of=b2](b3){};
                \draw[->](b3) to (b2);
                \node[badblockunreleased, below of=b3](b4){};
                \draw[->](b4) to (b3);
                }
            \end{tikzpicture}
        \end{figure}
        \column{.5\textwidth}
        \uncover<5->{
            \begin{figure}
                \centering
                \includegraphics{figure-source/mining-rate-security.pdf}
            \end{figure}
            Same when increasing the block size
        }
    \end{columns}
\end{frame}

\begin{frame}
    \frametitle{Two roles of a block: proposing and voting}
    \begin{figure}
        \tikzstyle{block} = [draw, fill=blue!20, rectangle, rounded corners, minimum height=1.3em, minimum width=2.1em, text centered]
        \begin{tikzpicture}[auto, node distance=2.3em, >=latex']
            \node[block](genesis){};
            \node[block, below of=genesis](1){};
            \draw[->](1) to (genesis);
            \node[block, below of=1](2){};
            \draw[->](2) to (1);
            \node[block, below of=2](3){};
            \draw[->](3) to (2);
            \uncover<2->{
                \node[block, below of=3](4){TX};
                \draw[->](4) to (3);
            }
            \uncover<3->{
                \node[right=1em of 4](){Add new transactions};
            }
            \uncover<4->{
                \draw[densely dashed, ->] (4.west) to [bend left, looseness=1.2] (3.west);
                \draw[densely dashed, ->] (4.west) to [bend left, looseness=1.2] (2.west);
                \draw[densely dashed, ->] (4.west) to [bend left, looseness=1.2] (1.west);
                \draw[densely dashed, ->] (4.west) to [bend left, looseness=1.2] (genesis.west);
                \node[left=2em of 2](){Certify previous blocks};
            }
        \end{tikzpicture}
    \end{figure}
\end{frame}

\begin{frame}
    \frametitle{Scale proposing with lots of transaction blocks}
    \begin{figure}
        \tikzstyle{transaction} = [draw, fill=blue!20, rectangle, rounded corners, minimum height=1em, minimum width=1.6em, text centered]
        \tikzstyle{voter} = [draw, fill=green!20, rectangle, rounded corners, minimum height=1em, minimum width=1.6em]
        \tikzstyle{proposer} = [draw, circle, fill=yellow!20]
        \begin{tikzpicture}[auto, node distance=2.3em, >=latex']
            \node[transaction](tx1){};
            \node[transaction, left of=tx1](tx2){};
            \node[transaction, left of=tx2](tx3){};
            \pause
            \node[proposer, right= 2em of tx1](p1){};
            \draw[->] (p1) to [bend right, looseness=1.0] (tx1);
            \draw[->] (p1) to [bend right, looseness=1.0] (tx2);
            \draw[->] (p1) to [bend right, looseness=1.0] (tx3);
            \pause
            \node[transaction, below of=tx1](tx4){};
            \node[transaction, left of=tx4](tx5){};
            \node[transaction, left of=tx5](tx6){};
            \node[transaction, left of=tx6](tx7){};
            \pause
            \node[proposer, below of=p1](p2){};
            \draw[->] (p2) to [bend right, looseness=1.0] (tx4);
            \draw[->] (p2) to [bend right, looseness=1.0] (tx5);
            \draw[->] (p2) to [bend right, looseness=1.0] (tx6);
            \draw[->] (p2) to [bend right, looseness=1.0] (tx7);
            \draw[->] (p2) to (p1);
            \pause
            \node[transaction, below of=tx4](tx8){};
            \node[transaction, left of=tx8](tx9){};
            \node[proposer, below of=p2](p3){};
            \draw[->] (p3) to (p2);
            \draw[->] (p3) to [bend right, looseness=1.0] (tx8);
            \draw[->] (p3) to [bend right, looseness=1.0] (tx9);
            \pause
            \node[transaction, below of=tx8](tx10){};
            \node[transaction, left of=tx10](tx11){};
            \node[transaction, left of=tx11](tx12){};
            \node[proposer, below of=p3](p4){};
            \draw[->] (p4) to [bend right, looseness=1.0] (tx10);
            \draw[->] (p4) to [bend right, looseness=1.0] (tx11);
            \draw[->] (p4) to [bend right, looseness=1.0] (tx12);
            \draw[->] (p4) to (p3);
        \end{tikzpicture}
    \end{figure}
\end{frame}

\begin{frame}
    \frametitle{Scale voting with lots of voter chains}
    \begin{figure}
        \tikzstyle{transaction} = [draw, fill=blue!20, rectangle, rounded corners, minimum height=1em, minimum width=1.6em, text centered]
        \tikzstyle{voter} = [draw, fill=green!20, rectangle, rounded corners, minimum height=1em, minimum width=1.6em]
        \tikzstyle{proposer} = [draw, circle, fill=yellow!20]
        \begin{tikzpicture}[auto, node distance=2.3em, >=latex']
            \node[transaction](tx1){};
            \node[proposer, right= 2em of tx1](p1){};
            \draw[->] (p1) to [bend right, looseness=1.0] (tx1);
            \node[left of=tx1]{...};
            \node[transaction, below of=tx1](tx2){};
            \node[proposer, below of=p1](p2){};
            \node[left of=tx2]{...};
            \draw[->] (p2) to [bend right, looseness=1.0] (tx2);
            \uncover<1>{
                \draw[->] (p2) to (p1);
            }
            \node[transaction, below of=tx2](tx3){};
            \node[proposer, below of=p2](p3){};
            \node[left of=tx3]{...};
            \uncover<1>{
                \draw[->] (p3) to (p2);
            }
            \draw[->] (p3) to [bend right, looseness=1.0] (tx3);
            \node[transaction, below of=tx3](tx4){};
            \node[proposer, below of=p3](p4){};
            \node[left of=tx4]{...};
            \draw[->] (p4) to [bend right, looseness=1.0] (tx4);
            \uncover<1>{
                \draw[->] (p4) to (p3);
            }
            \uncover<3->{
                \node[voter, right=2em of p1](v11){};
                \node[voter, below of=v11](v12){};
                \node[voter, below of=v12](v13){};
                \node[voter, below of=v13](v14){};
                \draw[->] (v12) to (v11);
                \draw[->] (v13) to (v12);
                \draw[->] (v14) to (v13);
                \draw[densely dashed, ->] (v11) to [bend right, looseness=1.0] (p1);
                \draw[densely dashed, ->] (v12) to [bend right, looseness=1.0] (p2);
                \draw[densely dashed, ->] (v13) to [bend right, looseness=1.0] (p3);
                \draw[densely dashed, ->] (v14) to [bend right, looseness=1.0] (p4);
            }
            \uncover<4->{
                \node[voter, right of=v11](v21){};
                \node[voter, below of=v21](v22){};
                \node[voter, below of=v22](v23){};
                \node[voter, below of=v23](v24){};
                \draw[->] (v22) to (v21);
                \draw[->] (v23) to (v22);
                \draw[->] (v24) to (v23);
                \draw[densely dashed, ->] (v21) to [bend right, looseness=1.0] (p1);
                \draw[densely dashed, ->] (v22) to [bend right, looseness=1.0] (p2);
                \draw[densely dashed, ->] (v23) to [bend right, looseness=1.0] (p3);
                \draw[densely dashed, ->] (v24) to [bend right, looseness=1.0] (p4);
                \node[right of=v21](v31){\dots};
                \node[right of=v22](v32){\dots};
                \node[right of=v23](v33){\dots};
                \node[right of=v24](v34){\dots};
                \node[voter, right of=v31](v41){};
                \node[voter, below of=v41](v42){};
                \node[voter, below of=v42](v43){};
                \node[voter, below of=v43](v44){};
                \draw[->] (v42) to (v41);
                \draw[->] (v43) to (v42);
                \draw[->] (v44) to (v43);
                \draw[densely dashed, ->] (v41) to [bend right, looseness=1.0] (p1);
                \draw[densely dashed, ->] (v42) to [bend right, looseness=1.0] (p2);
                \draw[densely dashed, ->] (v43) to [bend right, looseness=1.0] (p3);
                \draw[densely dashed, ->] (v44) to [bend right, looseness=1.0] (p4);
            }
        \end{tikzpicture}
    \end{figure}
    \begin{itemize}
        \item<3-> 1 voter chain: 25-deep
        \item<4-> 1000 voter chains: 2-deep
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Prism is provably fast and secure}
    Adversary power $\beta < 0.5$

    \begin{itemize}
        \item \alert{Security}: consistency and liveness
            \pause
        \item \alert{Throughput}: $(1-\beta)C$
            \pause
        \item \alert{Confirmation Latency}: $O\left(D\right) + O\left(\frac{-D\log\left(\epsilon\right)}{m}\right)$
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Prism throughput approaches the network bandwidth}
    \begin{figure}
        \centering
        \includegraphics{figure-source/theory-throughput.pdf}
    \end{figure}
\end{frame}

\begin{frame}
    \frametitle{Prism latency approaches the network latency}
    \begin{figure}
        \centering
        \includegraphics{figure-source/theory-latency.pdf}
    \end{figure}
\end{frame}

\section{System implementation}

\begin{frame}
    \tableofcontents[currentsection,currentsubsection]
\end{frame}

\begin{frame}
    \frametitle{Implementing Prism in Rust}
    \begin{itemize}
        \item 10,000 lines of Rust
        \item UTXO model
        \item Pay-to-public-key transactions
        \item Code available at t.leiy.me/prism-code
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Blockchain client: consensus and ledger keeping}
    \begin{figure}
        \tikzstyle{ledger} = [draw, fill=blue!20, rectangle, 
        minimum height=4em, minimum width=6em, text centered, text width=5em]
        \tikzstyle{blockchain} = [draw, fill=red!20, rectangle, minimum height=4em, minimum width=6em, text centered, text width=5em]
        \tikzstyle{miner} = [draw, fill=green!20, rectangle, minimum height=4em, minimum width=6em, text centered, text width=5em]

        \tikzstyle{database} = [draw, fill=yellow!20, rectangle, rounded corners, text width=5em, minimum height=3em, minimum width=6em, text centered]

        % The block diagram code is probably more verbose than necessary
        \begin{tikzpicture}[auto, node distance=2.8cm,>=latex']
            \uncover<1->{
            \node [database] (blockchaindb) {Block Structure Database};
            \node [blockchain, above=0.5cm of blockchaindb] (blockchain) {Block Structure Manager};
            \node [database, left of=blockchain] (blockdb) {Block Database};
            \draw [<->] (blockchaindb) -- node[name=a] {} (blockchain);
            \draw [<->] (blockchain) -- node[name=g]{} (blockdb);
            \node [above=0.5cm of blockchain] (peers) {Peers};
            \draw [<->] (peers) -- node[name=j]{} (blockchain);
            }
            \uncover<2->{
            \node [miner, right of=blockchaindb] (miner) {Miner};
            \node [database, right of=blockchain] (mempool) {Memory Pool};
            \node [right of=peers] (newtx) {New Transactions};
            \draw [->] (blockchaindb) -- node[name=b] {} (miner);
            \draw [<-] (blockchain) -- node[name=d] {} (miner);
            \draw [->] (blockchain) -- node[name=f]{} (mempool);
            \draw [<->] (miner) -- node[name=e]{} (mempool);
            \draw [->] (newtx) -- node[name=k]{} (mempool);
            }
            \uncover<3->{
            \node [ledger, left of=blockchaindb] (ledger) {Ledger Manager};
            \node [database, left of=ledger] (utxodb) {UTXO Database};
            \draw [<->] (blockchaindb) -- node[name=c] {} (ledger);
            \draw [<->] (ledger) -- node[name=h]{} (utxodb);
            \draw [<-] (ledger) -- node[name=i]{} (blockdb);
            }
        \end{tikzpicture}
    \end{figure}
\end{frame}

\begin{frame}
    \frametitle{High throughput brings challenges}
    In real time:
    \begin{itemize}
        \item 70,000 tps
        \item 400 blocks/s
        \item 1000 chains
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Enable parallel transaction execution with scoreboarding}
    \begin{figure}
        \tikzstyle{transaction} = [draw, fill=blue!20, rectangle, minimum height=1em, minimum width=1.6em, text centered]
        \tikzstyle{cpu} = [draw, densely dashed, rectangle, inner sep=1.5mm, line width=1.8pt, color=olive]
        \tikzstyle{coin} = [draw, circle, fill=yellow!20, text centered]
        \tikzstyle{badcoin} = [draw, circle, fill=red!20, text centered]
        \begin{tikzpicture}[auto, node distance=2.2em, >=latex']
            \node [transaction](t1){A$\rightarrow$C};
            \node [transaction, below of=t1](t2){A$\rightarrow$D};
            \node [transaction, below of=t2](t3){B$\rightarrow$E};
            \node [transaction, below of=t3](t4){E$\rightarrow$F};
            \uncover<1-5,10-13,16-19>{
                \node [coin,left=2em of t1](b){B};
            }
            \uncover<1-2,10-11,16-19>{
                \node [coin,left=1em of b](a){A};
            }
            \uncover<3-9,20->{
                \node [coin, left=1em of b](c){C};
            }
            \uncover<6-7,20-23>{
                \node [coin, left=2em of t1](e){E};
            }
            \uncover<8-9,24->{
                \node [coin, left=2em of t1](f){F};
            }
            \uncover<12-15>{
                \node [badcoin, left=1em of b](d){D};
            }
            \uncover<14-15>{
                \node [badcoin, left=2em of t1](e2){E};
            }

            \uncover<2-3,11-12,18-20>{
                \node [cpu, fit=(t1)]{};
            }
            \uncover<4,11-12,23-24>{
                \node [cpu, fit=(t2)]{};
            }
            \uncover<5-6,13-14,19-20>{
                \node [cpu, fit=(t3)]{};
            }
            \uncover<7-8,13-14,23-24>{
                \node [cpu, fit=(t4)]{};
            }
        \end{tikzpicture}
    \end{figure}
    \uncover<16->{
        \alert{Scoreboard: }
        \only<17-18>{
            A, C
        }
        \only<19-20>{
            A, B, C, E
        }
        \only<21>{}
        \only<22-24>{A, D, E, F}
        \only<25>{}
    }
\end{frame}

\begin{frame}
    \frametitle{Enable parallel transaction execution with scoreboarding}
    \begin{figure}
        \centering
        \includegraphics{figure-source/resource-fig-cpu.pdf}
    \end{figure}
\end{frame}

% TODO: polish
\begin{frame}
    \frametitle{Handle high block rate with async ledger update}
    \begin{figure}
        \tikzstyle{ledger} = [draw, fill=blue!20, rectangle, 
        minimum height=4em, minimum width=6em, text centered, text width=5em]
        \tikzstyle{blockchain} = [draw, fill=red!20, rectangle, minimum height=4em, minimum width=6em, text centered, text width=5em]
        \tikzstyle{miner} = [draw, fill=green!20, rectangle, minimum height=4em, minimum width=6em, text centered, text width=5em]

        \tikzstyle{database} = [draw, fill=yellow!20, rectangle, rounded corners, text width=5em, minimum height=3em, minimum width=6em, text centered]

        % The block diagram code is probably more verbose than necessary
        \begin{tikzpicture}[auto, node distance=2.8cm,>=latex']
            \uncover<1>{
            \node [database] (blockchaindb) {Block Structure Database};
            }
            \uncover<1->{
            \node [blockchain, above=0.5cm of blockchaindb] (blockchain) {Block Structure Manager};
            \node [miner, right of=blockchaindb] (miner) {Miner};
            \node [ledger, left of=blockchaindb] (ledger) {Ledger Manager};
            \draw [<-] (blockchain) -- node[name=d] {} (miner);
            }
            \uncover<1>{
            \node [database, left of=blockchain] (blockdb) {Block Database};
            \draw [<->] (blockchaindb) -- node[name=a] {} (blockchain);
            \draw [<->] (blockchain) -- node[name=g]{} (blockdb);
            \node [above=0.5cm of blockchain] (peers) {Peers};
            \draw [<->] (peers) -- node[name=j]{} (blockchain);
            }
            \uncover<1>{
            \node [database, right of=blockchain] (mempool) {Memory Pool};
            \node [right of=peers] (newtx) {New Transactions};
            \draw [->] (blockchaindb) -- node[name=b] {} (miner);
            \draw [->] (blockchain) -- node[name=f]{} (mempool);
            \draw [<->] (miner) -- node[name=e]{} (mempool);
            \draw [->] (newtx) -- node[name=k]{} (mempool);
            }
            \uncover<1>{
            \node [database, left of=ledger] (utxodb) {UTXO Database};
            \draw [<->] (blockchaindb) -- node[name=c] {} (ledger);
            \draw [<->] (ledger) -- node[name=h]{} (utxodb);
            \draw [<-] (ledger) -- node[name=i]{} (blockdb);
            }
        \end{tikzpicture}
    \end{figure}
    \uncover<2->{
    \begin{itemize}
        \item Ledger updates are ``infrequent''
        \item Sanitize later
    \end{itemize}
    }
\end{frame}

\begin{frame}
    \frametitle{Reduce spams using random jittering}
    \begin{figure}
        \tikzstyle{node} = [draw, fill=green!20, rectangle, 
        minimum height=4em, minimum width=6em, text centered, text width=5em]
        \tikzstyle{transaction} = [draw, fill=yellow!20, rectangle, minimum height=1em, minimum width=1.6em, text centered]
        \tikzstyle{block} = [draw, fill=blue!20, rectangle, rounded corners, minimum height=2.5em, minimum width=2.5em, text centered]
        \begin{tikzpicture}[auto, node distance=4em,>=latex']
            \node[node](n1){Node 1};
            \node[node, right=7em of n1](n2){Node 2};
            \draw[<->, line width=1.8pt](n1) -- (n2);
            \uncover<2,5-7>{
                \node[transaction, below of=n1](t1){A$\rightarrow$B};
            }
            \uncover<6-7>{
                \node[left=1em of t1]{Delayed};
            }
            \uncover<2,5>{
                \node[transaction, below of=n2](t2){A$\rightarrow$C};
            }
            \uncover<3-4>{
                \node[block, above of=n1](b1){A$\rightarrow$B};
                \node[block, above of=n2](b2){A$\rightarrow$C};
            }
            \uncover<4>{
                \node[block, right= 0.5em of b1](b21){A$\rightarrow$C};
                \node[block, left= 0.5em of b2](b12){A$\rightarrow$B};
            }
            \uncover<6-8>{
                \node[block, above of=n2](b2){A$\rightarrow$C};
            }
            \uncover<7-8>{
                \node[block, above of=n1](b21){A$\rightarrow$C};
            }

        \end{tikzpicture}
    \end{figure}
\end{frame}

\begin{frame}
    \frametitle{Reduce spams using random jittering}
    \begin{figure}
        \centering
        \includegraphics{figure-source/attack-fig-spamming.pdf}
    \end{figure}
\end{frame}

\section{Evaluation results and findings}


\begin{frame}
    \tableofcontents[currentsection,currentsubsection]
\end{frame}

\begin{frame}
    \frametitle{Testbed setup}
    \begin{itemize}
        \item 100 - 1000 AWS EC2 instances
        \item Random 4-regular graph
        \item 120ms propagation delay
        \item 400 Mbps bandwidth
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Comparison with Algorand, Bitcoin-NG, Nakamoto}
    % mention algorand bottleneck
    \only<1>{
    \begin{figure}
        \centering
        \includegraphics{figure-source/compare-fig-1.pdf}
    \end{figure}
    }
    \only<2>{
    \begin{figure}
        \centering
        \includegraphics{figure-source/compare-fig-2.pdf}
    \end{figure}
    }
    \only<3>{
    \begin{figure}
        \centering
        \includegraphics{figure-source/compare-fig.pdf}
    \end{figure}
    }
    % TODO: mention scalability
\end{frame}

\begin{frame}
    \frametitle{Prism is robust against censorship attacks}
    \begin{figure}
        \centering
        \includegraphics{figure-source/attack-fig-censor.pdf}
    \end{figure}
\end{frame}

\begin{frame}
    \frametitle{Prism is robust against balancing attacks}
    \begin{figure}
        \centering
        \includegraphics{figure-source/attack-fig-balancing.pdf}
    \end{figure}
\end{frame}

\begin{frame}
    \frametitle{Our implementation is efficient}
    \begin{block}{CPU}
    \begin{itemize}
        \item Signature check: 22\%
        \item RocksDB: 53\%
        \item Data serialization: 7\%
    \end{itemize}
    \end{block}
    \begin{block}{Bandwidth}
    \begin{itemize}
        \item Transaction blocks: 99.5\%
        \item Voter blocks: 0.4\%
        \item Proposer blocks: 0.1\%
    \end{itemize}
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{Takeaways}
    \begin{block}{}
    \begin{itemize}
        \item Prism approaches the physical limit by deconstructing and scaling each part
        \item Prism is proven with a real implementation
        \item Building a high performance blockchain client requires careful design
    \end{itemize}
    \end{block}
    \begin{block}{Resources}
    \begin{itemize}
        \item Code: t.leiy.me/prism-code
        \item Theory Paper: Deconstructing the Blockchain to Approach Physical Limits
        \item System Paper: t.leiy.me/prism-paper
        \item Online Demo: t.leiy.me/prism-demo
    \end{itemize}
    \end{block}
\end{frame}


\end{document}
